# PLANS 2.4 - Telegram cache persistence

## 2.4.1 Feature scope

1. [x] (2.4.1.1) Persist chat metadata for fast chat list rendering.
2. [x] (2.4.1.2) Persist a bounded cache of recent messages per chat.
3. [x] (2.4.1.3) Load cache into memory on startup to avoid redundant fetches.
4. [x] (2.4.1.4) Enforce cache limits by chat count and message count.
5. [x] (2.4.1.5) Keep storage pluggable for future backends.
6. [x] (2.4.1.6) Surface cache reads for UI and LLM export workflows.
7. [x] (2.4.1.7) Default max messages per chat is 5000.

## 2.4.2 Implementation notes

1. [x] (2.4.2.1) Add cache types and manager in `core/src/telegram/cache.rs`.
2. [x] (2.4.2.2) Define a `CacheStore` trait with load and save operations.
3. [x] (2.4.2.3) Implement a file-backed store with atomic snapshot writes.
4. [x] (2.4.2.4) Update cache on domain events for new and edited messages.
5. [x] (2.4.2.5) Add cache config wiring in `app/src/config.rs`.
6. [x] (2.4.2.6) Expose cache read APIs from `core/src/telegram/mod.rs`.
7. [x] (2.4.2.7) Debounce cache writes and keep them off the UI thread.
8. [x] (2.4.2.8) Use sqlite as the default cache store backend.

## 2.4.3 Current state checklist

1. [x] (2.4.3.1) Cache types and store trait implemented in core.
2. [x] (2.4.3.2) File store implemented with load and save.
3. [x] (2.4.3.3) Cache manager wired to domain events.
4. [x] (2.4.3.4) App config includes cache settings.
5. [x] (2.4.3.5) Unit tests cover cache behavior and persistence.

## 2.4.4 Next steps

1. [x] (2.4.4.1) Finalize cache domain model and limits.
2. [x] (2.4.4.2) Choose snapshot format and file path defaults.
3. [x] (2.4.4.3) Implement cache manager and store.
4. [x] (2.4.4.4) Add unit tests and run core test suite.

## 2.4.5 Follow-ups and gaps

1. [ ] (2.4.5.1) Add OS-specific data directories for production.
2. [ ] (2.4.5.2) Add message search index or secondary cache for search.
3. [ ] (2.4.5.3) Add encryption at rest if needed for shared machines.

## 2.4.6 Logging

1. (2.4.6.1) Primary log file is `data/logs/app.log` (configured in
   `app/config/app.toml`).
2. (2.4.6.2) Error log file is `data/logs/app-error.log` (configured in
   `app/config/app.toml`).
3. (2.4.6.3) Log level uses `[logging].level` in `app/config/app.toml`
   (default `info`).
4. (2.4.6.4) Log format uses `[logging].format` in `app/config/app.toml`
   (default `plain`).
5. (2.4.6.5) Rotation uses `[logging].rotation` and size-based defaults in
   `app/config/app.toml`.
