# SDD 3.2 - Input ergonomics

## 1.0 Idea

Deliver keyboard-first ergonomics for navigating chats and messages, including
vim or VSCode-style keymaps, scrollback, in-chat search, and message selection
for later LLM export.

## 2.0 Structured spec

### 2.1 Scope

- [x] (2.1.1) Introduce a focus model for chats, messages, composer, and search.
- [x] (2.1.2) Support vim-style navigation and search bindings.
- [x] (2.1.3) Support VSCode-style navigation and search bindings.
- [x] (2.1.4) Add message cursor movement with scrollback and paging.
- [x] (2.1.5) Add message selection toggles for export preparation.
- [x] (2.1.6) Add in-chat search with match cycling and markers.

### 2.2 Out of scope

- [ ] (2.2.1) Full event loop wiring and config-driven keymap selection.
- [ ] (2.2.2) Message virtualization or long-list performance tuning.
- [ ] (2.2.3) LLM export pipeline or transcript formatting.
- [ ] (2.2.4) Accessibility and theming (tracked in 3.3).

### 2.3 Interaction behavior

- [x] (2.3.1) Focus cycles chats -> messages -> composer with `Tab`.
- [x] (2.3.2) Chats: Up/Down (VSCode) or j/k (vim) moves selection.
- [x] (2.3.3) Messages: Up/Down or j/k moves cursor; Home/End or gg/G jumps.
- [x] (2.3.4) Messages: PageUp/PageDown (VSCode) or Ctrl+b/Ctrl+f (vim) scrolls.
- [x] (2.3.5) Messages: Space toggles selection for the focused message.
- [x] (2.3.6) Search: Ctrl+f or / opens search; F3 or n/N cycles matches.
- [x] (2.3.7) Search query matches author or body, case-insensitive.
- [x] (2.3.8) Search matches are marked and cursor jumps to current match.

### 2.4 UI state model

- [x] (2.4.1) Message view state stores scroll offset, cursor, and selections.
- [x] (2.4.2) Search state stores query, matches, and selected match index.
- [x] (2.4.3) Cache refresh reconciles selection and cursor with message IDs.

## 3.0 Implementation plan

- [x] (3.1.1) Extend UI state with focus, message view, and search state.
- [x] (3.1.2) Add interaction module with keymap-aware handlers.
- [x] (3.1.3) Update UI cache mapping with stable message and chat IDs.
- [x] (3.1.4) Render selection and search markers with scroll offset.
- [x] (3.1.5) Add unit tests for key handling, search, and selection.
- [x] (3.1.6) Update UI snapshots for the new markers.

## 4.0 Test plan (generation)

- [x] (4.1.1) Verify vim and VSCode cursor navigation.
- [x] (4.1.2) Verify message selection toggling and retention.
- [x] (4.1.3) Verify search opens, updates matches, and cycles.
- [x] (4.1.4) Update layout snapshots for selection/search markers.

## 5.0 Code plan (follow-up after tests)

- [x] (5.1.1) Implement `ui::interaction` and message view state helpers.
- [x] (5.1.2) Wire cache mapping to include IDs and reconcile selections.
- [x] (5.1.3) Run formatting, linting, and tests.
