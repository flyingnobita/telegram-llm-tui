# PLANS 2.3 - Telegram send pipeline

## 2.3.1 Feature scope

1. [x] (2.3.1.1) Send text messages with optional reply-to.
2. [x] (2.3.1.2) Edit messages by ID.
3. [x] (2.3.1.3) Delete messages by ID.
4. [x] (2.3.1.4) Queue unsent messages when offline or transient errors occur.
5. [x] (2.3.1.5) Apply rate-limit waits and exponential backoff.
6. [x] (2.3.1.6) Provide status updates for queued, sending, sent, failed.

## 2.3.2 Implementation notes

1. [x] (2.3.2.1) Add `core/src/telegram/send.rs` with send pipeline types.
2. [x] (2.3.2.2) Implement a `SendTransport` trait with a grammers adapter.
3. [x] (2.3.2.3) Add bounded queue with retry scheduling by next-attempt time.
4. [x] (2.3.2.4) Implement retry classification for rate-limit and transient errors.
5. [x] (2.3.2.5) Add `SendPipelineConfig` and wire into `TelegramConfig`.
6. [x] (2.3.2.6) Add app config fields for send pipeline defaults.
7. [x] (2.3.2.7) Add structured logging for send attempts and failures.
8. [x] (2.3.2.8) Add unit tests for queue, retry, and failure behaviors.

## 2.3.3 Current state checklist

1. [x] (2.3.3.1) Send pipeline types implemented in core.
2. [x] (2.3.3.2) Grammers adapter implemented.
3. [x] (2.3.3.3) App config wired for send pipeline settings.
4. [x] (2.3.3.4) Core unit tests passing.

## 2.3.4 Next steps

1. [x] (2.3.4.1) Implement send pipeline worker and retry logic.
2. [x] (2.3.4.2) Add configuration wiring in app config and bootstrap.
3. [x] (2.3.4.3) Add unit tests for queue and retry behaviors.

## 2.3.5 Follow-ups and gaps

1. [ ] (2.3.5.1) Persist send queue across restarts.
2. [ ] (2.3.5.2) Add media and file upload support to send pipeline.
3. [ ] (2.3.5.3) Resolve peers from bare `ChatId` values.

## 2.3.6 Logging

1. (2.3.6.1) Primary log file is `data/logs/app.log` (configured in
   `app/config/app.toml`).
2. (2.3.6.2) Error log file is `data/logs/app-error.log` (configured in
   `app/config/app.toml`).
3. (2.3.6.3) Log level uses `[logging].level` in `app/config/app.toml`
   (default `info`).
4. (2.3.6.4) Log format uses `[logging].format` in `app/config/app.toml`
   (default `plain`).
5. (2.3.6.5) Rotation uses `[logging].rotation` and size-based defaults in
   `app/config/app.toml`.
