# PLANS 2.1 - Telegram core bootstrap, auth, and update pump

## 2.1.1 Feature scope

1. [x] (2.1.1.1) Bootstrap a grammers client with session storage and
   connection runner.
2. [x] (2.1.1.2) Implement auth flow with phone code login.
3. [x] (2.1.1.3) Implement auth flow with QR login.
4. [x] (2.1.1.4) Provide update pump that streams Telegram updates in the
   background.

## 2.1.2 Implementation notes

1. [x] (2.1.2.1) `TelegramBootstrap` builds a `SqliteSession`, `SenderPool`,
   and `Client` then spawns the pool runner.
2. [x] (2.1.2.2) `AuthFlow` wraps `GrammersAuthClient` for phone and QR login
   flows with testable interfaces.
3. [x] (2.1.2.3) `UpdatePump` pulls from `UpdateStream` and sends events to a
   bounded channel.
4. [x] (2.1.2.4) Core exports added under `telegram` module for app wiring.
5. [x] (2.1.2.5) Native deps documented for sqlite session storage.
6. [x] (2.1.2.6) App config loader reads `TELEGRAM_API_ID`,
   `TELEGRAM_API_HASH`, `TELEGRAM_SESSION_PATH`, and
   `TELEGRAM_UPDATE_BUFFER`.
7. [x] (2.1.2.7) CLI prompts handle auth choices, phone codes, and 2FA
   password input.
8. [x] (2.1.2.8) Logging added around auth transitions and update pump
   lifecycle.

## 2.1.3 Current state checklist

1. [x] (2.1.3.1) `core/src/telegram/bootstrap.rs` defines `TelegramConfig`
   and `TelegramBootstrap`.
2. [x] (2.1.3.2) `core/src/telegram/auth.rs` defines auth flow and grammers
   adapter.
3. [x] (2.1.3.3) `core/src/telegram/updates.rs` defines update pump and
   utilities.
4. [x] (2.1.3.4) Unit tests cover auth flow and update pump.
5. [x] (2.1.3.5) `app/src/config.rs` defines env config loader.
6. [x] (2.1.3.6) `app/src/prompt.rs` defines CLI auth prompts.
7. [x] (2.1.3.7) `app/src/main.rs` wires bootstrap, auth, and update pump.

## 2.1.4 Next steps

1. [x] (2.1.4.1) Wire `TelegramBootstrap` into `app/src/main.rs` and run a
   real login flow.
2. [x] (2.1.4.2) Add config loading for `api_id`, `api_hash`, and
   `session_path`.
3. [x] (2.1.4.3) Decide how to surface auth prompts in the TUI layer (CLI
   prompts for now).
4. [x] (2.1.4.4) Add logging around update pump lifecycle and auth transitions.

## 2.1.5 Follow-ups and gaps

1. [ ] (2.1.5.1) Verify QR login behavior in a real Telegram account.
2. [x] (2.1.5.2) Add integration tests with mocked grammers responses.
3. [ ] (2.1.5.3) Document session file location for dev users.
4. [ ] (2.1.5.4) Replace CLI auth prompts with TUI flows.

## 2.1.6 Logging

1. (2.1.6.1) Primary log file: `data/logs/app.log` (configured in
   `app/config/app.toml` under `[logging].log_file`).
2. (2.1.6.2) Error log file: `data/logs/app-error.log` (configured in
   `app/config/app.toml` under `[logging].error_log_file`).
3. (2.1.6.3) Log level: configured in `app/config/app.toml` under
   `[logging].level` (default `info`).
4. (2.1.6.4) Log format: plain text (configured in `app/config/app.toml` under
   `[logging].format`).
5. (2.1.6.5) Console output uses ANSI colors; log files disable ANSI
   formatting.
6. (2.1.6.6) Log timestamps use local time with RFC 3339 offset.
7. (2.1.6.7) Log rotation: size-based at 1 MB, keep 20 files (configured in
   `app/config/app.toml` under `[logging].rotation_max_size_mb` and
   `[logging].rotation_max_files`).
8. (2.1.6.8) Content logging: Telegram and LLM content logging enabled by
   default (configured in `app/config/app.toml` under `[logging].log_content`).
