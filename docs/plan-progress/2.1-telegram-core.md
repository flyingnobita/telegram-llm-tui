# PLANS 2.1 - Telegram core bootstrap, auth, and update pump

## Feature scope

- [x] Bootstrap a grammers client with session storage and connection runner
- [x] Implement auth flow with phone code login
- [x] Implement auth flow with QR login
- [x] Provide update pump that streams Telegram updates in the background

## Implementation notes

- [x] `TelegramBootstrap` builds a `SqliteSession`, `SenderPool`, and `Client`
  then spawns the pool runner
- [x] `AuthFlow` wraps `GrammersAuthClient` for phone and QR login flows with
  testable interfaces
- [x] `UpdatePump` pulls from `UpdateStream` and sends events to a bounded channel
- [x] Core exports added under `telegram` module for app wiring
- [x] Native deps documented for sqlite session storage
- [x] App config loader reads `TELEGRAM_API_ID`, `TELEGRAM_API_HASH`,
  `TELEGRAM_SESSION_PATH`, and `TELEGRAM_UPDATE_BUFFER`
- [x] CLI prompts handle auth choices, phone codes, and 2FA password input
- [x] Logging added around auth transitions and update pump lifecycle

## Current state checklist

- [x] `core/src/telegram/bootstrap.rs` defines `TelegramConfig` and
  `TelegramBootstrap`
- [x] `core/src/telegram/auth.rs` defines auth flow and grammers adapter
- [x] `core/src/telegram/updates.rs` defines update pump and utilities
- [x] Unit tests cover auth flow and update pump
- [x] `app/src/config.rs` defines env config loader
- [x] `app/src/prompt.rs` defines CLI auth prompts
- [x] `app/src/main.rs` wires bootstrap, auth, and update pump

## Next steps

- [x] Wire `TelegramBootstrap` into `app/src/main.rs` and run a real login flow
- [x] Add config loading for `api_id`, `api_hash`, and `session_path`
- [x] Decide how to surface auth prompts in the TUI layer (CLI prompts for now)
- [x] Add logging around update pump lifecycle and auth transitions

## Follow-ups and gaps

- [ ] Verify QR login behavior in a real Telegram account
- [ ] Add integration tests with mocked grammers responses
- [ ] Document session file location for dev users
- [ ] Replace CLI auth prompts with TUI flows

## Logging

- Error log file: `data/logs/app-error.log` (configured in
  `app/config/app.toml` under `[logging].error_log_file`).
- Log level: configured in `app/config/app.toml` under `[logging].level`
  (default `info`).
